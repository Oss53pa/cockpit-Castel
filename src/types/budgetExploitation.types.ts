/**
 * Types pour les budgets d'exploitation modifiables
 */

// Types de budget
export type BudgetExploitationType = 'mobilisation' | 'operationnel' | 'exploitation2027' | 'estimatif';

// Re-export CategorieExploitation from budget.types.ts (source of truth)
export type { CategorieExploitation } from './budget.types';

/**
 * Lien de justification attaché à une ligne budgétaire
 */
export interface LienJustification {
  id: string;
  titre: string;
  url: string;
  dateAjout: string;
}

/**
 * Ligne budgétaire d'exploitation
 */
export interface LigneBudgetExploitation {
  id?: number;
  siteId?: number;
  budgetType: BudgetExploitationType;
  annee: number; // 2026 ou 2027
  ordre: number; // Pour l'ordre d'affichage

  // Informations de base
  poste: string;
  description?: string;
  categorie: CategorieExploitation;

  // Montants
  montantPrevu: number;
  montantEngage: number;
  montantConsomme: number;

  // Métadonnées
  note?: string;
  commentaire?: string;
  liensJustification?: LienJustification[];
  icone?: string;
  couleur?: string;

  // Timestamps
  createdAt: string;
  updatedAt: string;
}

/**
 * Configuration du budget (dates de phase, etc.)
 */
export interface BudgetConfiguration {
  id?: number;
  siteId?: number;
  budgetType: BudgetExploitationType;
  annee: number;

  // Totaux configurés
  totalPrevu: number;

  // Configuration
  dateDebut: string;
  dateFin: string;
  occupation?: number; // % d'occupation pour calculs

  // Métadonnées
  description?: string;
  notes?: string;

  createdAt: string;
  updatedAt: string;
}

/**
 * Données par défaut pour initialisation
 */
export const DEFAULT_POSTES_EXPLOITATION_2027: Omit<LigneBudgetExploitation, 'id' | 'createdAt' | 'updatedAt'>[] = [
  {
    budgetType: 'exploitation2027',
    annee: 2027,
    ordre: 1,
    poste: 'Masse salariale',
    description: '25 personnes stabilisées',
    categorie: 'masse_salariale',
    montantPrevu: 165_000_000,
    montantEngage: 0,
    montantConsomme: 0,
    couleur: '#3B82F6',
  },
  {
    budgetType: 'exploitation2027',
    annee: 2027,
    ordre: 2,
    poste: 'Prestations externalisées',
    description: 'Sécurité 145M, Nettoyage 100M, Maintenance 50M',
    categorie: 'prestations',
    montantPrevu: 295_000_000,
    montantEngage: 0,
    montantConsomme: 0,
    couleur: '#10B981',
  },
  {
    budgetType: 'exploitation2027',
    annee: 2027,
    ordre: 3,
    poste: 'Fluides & Énergies',
    description: '1.1M kWh électricité, 20k m³ eau',
    categorie: 'fluides',
    montantPrevu: 160_000_000,
    montantEngage: 0,
    montantConsomme: 0,
    couleur: '#F59E0B',
  },
  {
    budgetType: 'exploitation2027',
    annee: 2027,
    ordre: 4,
    poste: 'Assurances',
    description: 'Multi-risque, RC, Perte exploitation',
    categorie: 'assurances',
    montantPrevu: 26_000_000,
    montantEngage: 0,
    montantConsomme: 0,
    couleur: '#8B5CF6',
  },
  {
    budgetType: 'exploitation2027',
    annee: 2027,
    ordre: 5,
    poste: 'Fonctionnement',
    description: 'Bureau, Télécom, Honoraires',
    categorie: 'fonctionnement',
    montantPrevu: 24_000_000,
    montantEngage: 0,
    montantConsomme: 0,
    couleur: '#6366F1',
  },
  {
    budgetType: 'exploitation2027',
    annee: 2027,
    ordre: 6,
    poste: 'Marketing & Communication',
    description: '4 événements majeurs, Digital, RP',
    categorie: 'marketing',
    montantPrevu: 35_000_000,
    montantEngage: 0,
    montantConsomme: 0,
    couleur: '#EC4899',
  },
  {
    budgetType: 'exploitation2027',
    annee: 2027,
    ordre: 7,
    poste: 'Provisions',
    description: 'Gros entretien, Créances douteuses, Litiges',
    categorie: 'provisions',
    montantPrevu: 20_000_000,
    montantEngage: 0,
    montantConsomme: 0,
    couleur: '#14B8A6',
  },
  {
    budgetType: 'exploitation2027',
    annee: 2027,
    ordre: 8,
    poste: 'Contingence (5%)',
    description: '5% sur total postes 1-7',
    categorie: 'contingence',
    montantPrevu: 36_000_000,
    montantEngage: 0,
    montantConsomme: 0,
    couleur: '#F97316',
  },
];

export const DEFAULT_POSTES_MOBILISATION: Omit<LigneBudgetExploitation, 'id' | 'createdAt' | 'updatedAt'>[] = [
  {
    budgetType: 'mobilisation',
    annee: 2026,
    ordre: 1,
    poste: 'Recrutement',
    description: 'Frais de recrutement et salaires équipe pilote',
    categorie: 'recrutement',
    montantPrevu: 118_000_000,
    montantEngage: 112_000_000,
    montantConsomme: 81_500_000,
    couleur: '#3B82F6',
  },
  {
    budgetType: 'mobilisation',
    annee: 2026,
    ordre: 2,
    poste: 'Formation',
    description: 'Formation initiale et externe',
    categorie: 'formation',
    montantPrevu: 40_000_000,
    montantEngage: 35_000_000,
    montantConsomme: 23_000_000,
    couleur: '#22C55E',
  },
  {
    budgetType: 'mobilisation',
    annee: 2026,
    ordre: 3,
    poste: 'Marketing',
    description: 'Identité visuelle, site web, campagne pré-ouverture',
    categorie: 'marketing',
    montantPrevu: 100_000_000,
    montantEngage: 75_000_000,
    montantConsomme: 48_000_000,
    couleur: '#8B5CF6',
  },
  {
    budgetType: 'mobilisation',
    annee: 2026,
    ordre: 4,
    poste: 'Événements',
    description: 'Soft Opening, Inauguration, Animations M1',
    categorie: 'evenements',
    montantPrevu: 100_000_000,
    montantEngage: 45_000_000,
    montantConsomme: 0,
    couleur: '#F59E0B',
  },
  {
    budgetType: 'mobilisation',
    annee: 2026,
    ordre: 5,
    poste: 'IT & Équipements',
    description: 'Systèmes informatiques, matériel, signalétique',
    categorie: 'it_equipements',
    montantPrevu: 72_000_000,
    montantEngage: 67_000_000,
    montantConsomme: 53_000_000,
    couleur: '#06B6D4',
  },
  {
    budgetType: 'mobilisation',
    annee: 2026,
    ordre: 6,
    poste: 'Aménagement',
    description: 'Mobilier bureaux et espaces',
    categorie: 'amenagement',
    montantPrevu: 33_000_000,
    montantEngage: 33_000_000,
    montantConsomme: 30_000_000,
    couleur: '#F97316',
  },
  {
    budgetType: 'mobilisation',
    annee: 2026,
    ordre: 7,
    poste: 'Frais généraux',
    description: 'Déplacements, fournitures, assurances',
    categorie: 'frais_generaux',
    montantPrevu: 40_000_000,
    montantEngage: 32_000_000,
    montantConsomme: 25_000_000,
    couleur: '#64748B',
  },
  {
    budgetType: 'mobilisation',
    annee: 2026,
    ordre: 8,
    poste: 'Provisions',
    description: 'Imprévus et réserve de trésorerie',
    categorie: 'provisions',
    montantPrevu: 65_500_000,
    montantEngage: 0,
    montantConsomme: 0,
    couleur: '#71717A',
  },
];
